<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
        <link rel="stylesheet" type="text/css" href="../css/aui-iconfont.css" />
    <style>
        body {
            background: transparent;
        }
        .splite{
          height: 150px;

        }
    </style>
</head>

<body>
    <div class="splite"></div>
    <div class="aui-content aui-margin-b-15">
        <ul class="aui-list aui-list-in">
            <li class="aui-bar aui-bar-nav">入会申请</li>
            <li class="aui-list-item">
                <div class="aui-list-item-label-icon">
                    <i class="aui-iconfont aui-icon-home"></i>
                </div>
                <div class="aui-list-item-inner" id="uTrueName">
                    用户：
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-label-icon">
                    <i class="aui-iconfont aui-icon-edit"></i>
                </div>
                <div class="aui-list-item-inner" id="tTrueName">
                    推荐人：
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-label-icon">
                    <i class="aui-iconfont aui-icon-camera"></i>
                </div>
                <div class="aui-list-item-inner">
                    选择级别：
                </div>
                <div class="aui-list-item-input aui-list-item-arrow">
                    <select id="jbSelect" onchange="fnChangeLevel()">
                          <option value="398">398会员</option>
                          <option value="1314">1314会员</option>
                          <option value="8800">8800会员</option>
                        </select>
                </div>
            </li>
            <li class="aui-list-item">

                <div class="aui-list-item-inner aui-list-item-center">
                    <div class="aui-btn aui-btn-primary  aui-btn-outlined" onclick="fnOK()">提交</div>
                    <div class="aui-btn aui-btn-primary  aui-btn-outlined aui-margin-l-10" onclick="fnCancel()">返回</div>
                </div>
            </li>
        </ul>
    </div>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript" src="../script/remotedb.js"></script>
<script type="text/javascript">
    apiready = function() {
        var uTrueName = $api.byId('uTrueName');
        tTrueName = $api.byId('tTrueName');
        uTrueName.innerHTML = '用户：' + $api.getStorage('userInfo').TrueName;
        yue = $api.getStorage('currentwallet') != null ? $api.getStorage('currentwallet').JieYu : 0;
        fnChangeLevel();
        tid = api.pageParam.tid;
        fnInit();
    };

    var level, yue, tid, fJE, tTrueName, flag = 0;

    function fnInit() {
        var filter = {
            where: {
                'Id': tid
            },
            skip: 0,
            limit: 1
        };
        fnGet('SysUser/GetUserInfoById', filter, function(ret, err) {
            if (ret&&ret.Jibie!='普通会员') {
                tTrueName.innerHTML = '引荐人：' + ret.TrueName;
            } else {
                alert('该引荐人不是会员，无法引荐别人');
                fnCancel();
            }
        });
    }

    function fnChangeLevel() {
        var sel = $api.byId('jbSelect');
        level = sel.value;
        if (flag > 0) {
            if (yue >= level) {
                api.confirm({
                    title: '确认提醒',
                    msg: '您当前余额为' + yue + ',满足入会要求,是否确认选择？',
                    buttons: ['确定', '取消']
                }, function(ret, err) {
                    if (ret.buttonIndex == 1) {
                      //  fnOK();
                    } else {
                    }
                });
            } else {
                //支付入会金额充值
                api.confirm({
                    title: '确认提醒',
                    msg: '请按级别预存相应金额',
                    buttons: ['确定', '取消']
                }, function(ret, err) {
                    if (ret.buttonIndex == 1) {
                        //打开充值窗口
                        api.openWin({
                            name: 'mychongzhi',
                            url: './mychongzhi.html',
                            pageParam: {
                                userid: $api.getStorage('userInfo').Id
                            }
                        });
                    } else {
                        alert("余额不足无法成为会员！");
                        return;
                    }
                });
            }
        } else {
            flag += 1;
        }
    }

    function fnOK() {
        var userid = $api.getStorage('userInfo').Id;
        fJE = level;
        api.confirm({
            title: '确认提醒',
            msg: '新会员等级为' + level + '会员，继续请单击确定？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret.buttonIndex == 1) {
              //打开分组选择frame
              api.openFrame({
                  name: 'selectgroup_frm',
                  url: './selectgroup_frm.html',
                  rect: {
                    x: 0,
                    y: 0,
                    w: api.winWidth,
                    h: api.winHeight
                  },
                  pageParam: {
                      userid: userid,
                      tid:tid,
                      fJE:fJE
                  },
                  bounces: true,
                  bgColor: 'rgba(0, 0, 0, 0.6)',
                  vScrollBarEnabled: true,
                  hScrollBarEnabled: true
              });

                //inClub(userid, tid, fJE);
            }
        });
    }

    //取消
    function fnCancel() {
        api.closeFrame({
            name: 'inClub_frm'
        });
    }
</script>

</html>
